function grad = ftf_grad(p, theta_0, theta_f)
    p1 = p(1);
    p2 = p(2);
    p3 = p(3);
    p4 = p(4);
    p5 = p(5);
    grad = zeros(3,1);
    grad(1) = (3*p5*(theta_0 - theta_f + p1*p5 - (p5*((11*p1)/2 - 9*p2 + (9*p3)/2 - p4))/2 - (p5*((9*p1)/2 - (27*p2)/2 + (27*p3)/2 - (9*p4)/2))/4 + (p5*(9*p1 - (45*p2)/2 + 18*p3 - (9*p4)/2))/3))/4;
    grad(2) = (3*p5*(theta_0 - theta_f + p1*p5 - (p5*((11*p1)/2 - 9*p2 + (9*p3)/2 - p4))/2 - (p5*((9*p1)/2 - (27*p2)/2 + (27*p3)/2 - (9*p4)/2))/4 + (p5*(9*p1 - (45*p2)/2 + 18*p3 - (9*p4)/2))/3))/4;
    grad(3) = 2*(p1/8 + (3*p2)/8 + (3*p3)/8 + p4/8)*(theta_0 - theta_f + p1*p5 - (p5*((11*p1)/2 - 9*p2 + (9*p3)/2 - p4))/2 - (p5*((9*p1)/2 - (27*p2)/2 + (27*p3)/2 - (9*p4)/2))/4 + (p5*(9*p1 - (45*p2)/2 + 18*p3 - (9*p4)/2))/3);
    
    grad_tmp = [3*p5*(p1*p5 + p5*(-11*p1 + 18*p2 - 9*p3 + 2*p4)/4 + p5*(-9*p1 + 27*p2 - 27*p3 + 9*p4)/8 + p5*(6*p1 - 15*p2 + 12*p3 - 3*p4)/2 + theta_0 - theta_f)/4, 3*p5*(p1*p5 + p5*(-11*p1 + 18*p2 - 9*p3 + 2*p4)/4 + p5*(-9*p1 + 27*p2 - 27*p3 + 9*p4)/8 + p5*(6*p1 - 15*p2 + 12*p3 - 3*p4)/2 + theta_0 - theta_f)/4, (p1/4 + 3*p2/4 + 3*p3/4 + p4/4)*(p1*p5 + p5*(-11*p1 + 18*p2 - 9*p3 + 2*p4)/4 + p5*(-9*p1 + 27*p2 - 27*p3 + 9*p4)/8 + p5*(6*p1 - 15*p2 + 12*p3 - 3*p4)/2 + theta_0 - theta_f)]
    
    a = 5;